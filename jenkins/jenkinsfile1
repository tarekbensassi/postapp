pipeline {
    agent any

    stages {
        stage('Deploy PostgreSQL') {
            steps {
                script {
                    sh 'kubectl apply -f postgres-deployment.yaml'
                    sh 'kubectl apply -f postgres-service.yaml'
                }
            }
        }

        stage('Deploy Spring App') {
            steps {
                script {
                    sh 'kubectl apply -f spring-app-deployment.yaml'
                    sh 'kubectl apply -f spring-app-service.yaml'
                }
            }
        }

        stage('Deploy Grafana') {
            steps {
                script {
                    sh 'kubectl apply -f grafana-deployment.yaml'
                    sh 'kubectl apply -f grafana-service.yaml'
                }
            }
        }

        stage('Deploy PostgreSQL PV and PVC') {
            steps {
                script {
                    sh 'kubectl apply -f postgres-pv-pvc.yaml'
                }
            }
        }
    }
}
